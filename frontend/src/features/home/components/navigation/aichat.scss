@use "../../../../styles/constants/colors" as colors;
@use "../../../../styles/constants/mixins" as mixins;

#ai_conversation {
  @include mixins.flexmixin(column, nowrap, flex-start, space-between, 0);
  width: 100%;
  height: 34rem;
  padding: 0 0.5rem;

  .title_close {
    @include mixins.flexmixin(row, nowrap, center, space-between, 0);
    width: 100%;
    position: sticky;
    top: 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid colors.$divider;
    z-index: 2;

    .title_left {
      @include mixins.flexmixin(row, nowrap, center, flex-start, 0.4rem);

      svg {
        color: colors.$brand;
      }

      p {
        font-weight: 500;
        font-size: 0.9375rem;
      }

      .back_btn {
        width: 1.625rem;
        height: 1.625rem;
        border-radius: 50%;
        color: colors.$text_secondary;
        transition: all 0.2s ease;

        &:hover {
          color: colors.$text_primary;
        }
      }
    }

    .title_actions {
      @include mixins.flexmixin(row, nowrap, center, flex-end, 0.375rem);

      .action_btn,
      .close_btn {
        width: 1.875rem;
        height: 1.875rem;
        border-radius: 50%;
        color: colors.$text_secondary;
        background-color: colors.$divider;
        transition: all 0.2s ease;

        &:hover {
          background-color: colors.$divider;
          color: colors.$text_primary;
        }
      }
    }
  }

  // ── conversation list view ──
  .conversation_list {
    flex: 1;
    width: 100%;
    overflow-y: auto;
    padding: 0.5rem 0;

    &::-webkit-scrollbar {
      width: 4px;
    }
    &::-webkit-scrollbar-thumb {
      background: colors.$divider;
      border-radius: 4px;
    }

    .conversation_item {
      @include mixins.flexmixin(row, nowrap, center, space-between, 0);
      width: 100%;
      padding: 0.625rem 0.75rem;
      border-radius: 0.5rem;
      text-align: left;
      transition: background-color 0.15s ease;
      cursor: pointer;

      &:hover {
        background-color: colors.$bg_tertiary;
      }

      .convo_info {
        flex: 1;
        min-width: 0;

        .convo_title {
          font-size: 0.875rem;
          font-weight: 500;
          color: colors.$text_primary;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .convo_meta {
          font-size: 0.75rem;
          color: colors.$text_secondary;
          margin-top: 0.125rem;
        }
      }

      .convo_delete {
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        color: colors.$text_secondary;
        opacity: 0;
        transition: all 0.15s ease;
        flex-shrink: 0;

        &:hover {
          color: colors.$danger;
        }
      }

      &:hover .convo_delete {
        opacity: 1;
      }
    }

    .new_chat_btn {
      @include mixins.flexmixin(row, nowrap, center, center, 0.375rem);
      margin-top: 0.75rem;
      padding: 0.625rem 1.25rem;
      border-radius: 0.875rem;
      background-color: colors.$brand;
      color: colors.$bg_secondary;
      transition: background-color 0.2s ease;
    }
  }

  .empty_state {
    @include mixins.flexmixin(column, nowrap, center, center, 0.625rem);
    height: 100%;
    text-align: center;
    padding: 2rem 1rem;

    svg {
      color: colors.$brand;
      opacity: 0.6;
    }

    .empty_title {
      font-weight: 600;
      font-size: 1.125rem;
      color: colors.$text_primary;
    }

    .empty_desc {
      font-size: 0.8125rem;
      color: colors.$text_secondary;
      line-height: 1.5;
      max-width: 280px;
    }
  }

  // ── messages area ──
  .ai_messages {
    flex: 1;
    width: 100%;
    overflow-y: auto;
    padding: 0.75rem 0;
    scroll-behavior: smooth;

    &::-webkit-scrollbar {
      width: 4px;
    }
    &::-webkit-scrollbar-thumb {
      background: colors.$divider;
      border-radius: 4px;
    }

    .ai_message {
      margin-bottom: 0.75rem;
      animation: fadeIn 0.25s ease;

      &.user {
        @include mixins.flexmixin(row, nowrap, flex-end, flex-end, 0);

        .user_content {
          background-color: colors.$brand;
          color: #fff;
          padding: 0.5rem 0.875rem;
          border-radius: 1rem 1rem 0.25rem 1rem;
          max-width: 85%;
          font-size: 0.875rem;
          line-height: 1.5;
          word-wrap: break-word;

          p {
            margin: 0;
          }
        }
      }

      &.assistant {
        @include mixins.flexmixin(row, nowrap, flex-start, flex-start, 0);

        .assistant_content {
          background-color: colors.$bg_tertiary;
          color: colors.$text_primary;
          padding: 0.5rem 0.875rem;
          border-radius: 1rem 1rem 1rem 0.25rem;
          max-width: 90%;
          font-size: 0.875rem;
          line-height: 1.6;
          word-wrap: break-word;
          overflow-x: auto;

          p {
            margin: 0 0 0.5rem 0;
            &:last-child {
              margin-bottom: 0;
            }
          }

          strong {
            font-weight: 600;
          }

          code {
            background-color: colors.$divider;
            padding: 0.125rem 0.375rem;
            border-radius: 4px;
            font-size: 0.8125rem;
            font-family: "SF Mono", "Fira Code", monospace;
          }

          pre {
            background-color: colors.$secondary_alt;
            color: #e6e6e6;
            padding: 0.75rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 0.5rem 0;
            font-size: 0.8125rem;

            code {
              background: none;
              padding: 0;
              color: inherit;
            }
          }

          ul,
          ol {
            margin: 0.25rem 0;
            padding-left: 1.25rem;
          }

          li {
            margin-bottom: 0.25rem;
          }

          a {
            color: colors.$brand;
            text-decoration: underline;
          }

          blockquote {
            border-left: 3px solid colors.$brand;
            padding-left: 0.75rem;
            margin: 0.5rem 0;
            color: colors.$text_secondary;
          }
        }
      }
    }

    .error_message {
      text-align: center;
      color: colors.$danger;
      font-size: 0.8125rem;
      padding: 0.25rem 0;
    }
  }

  // ── typing dots ──
  .typing_indicator {
    @include mixins.flexmixin(row, nowrap, center, flex-start, 0.25rem);
    padding: 0.25rem 0;

    span {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background-color: colors.$text_secondary;
      animation: bounce 1.2s infinite ease-in-out;

      &:nth-child(2) {
        animation-delay: 0.15s;
      }
      &:nth-child(3) {
        animation-delay: 0.3s;
      }
    }
  }

  // ── input bar ──
  .ai_input {
    @include mixins.flexmixin(row, nowrap, center, space-between, 0);
    position: sticky;
    bottom: 0;
    width: 100%;
    height: 3rem;
    padding-top: 0.375rem;
    border-top: 1px solid colors.$divider;

    input {
      width: calc(100% - 3rem);
      height: 100%;
      font-weight: 400;
      font-size: 0.875rem;

      &:disabled {
        opacity: 0.5;
      }
    }

    button {
      width: 2.25rem;
      height: 2.25rem;
      border-radius: 50%;
      color: colors.$bg_secondary;
      background-color: colors.$brand;
      transition: all 0.2s ease;

      &:hover:not(:disabled) {
        background-color: colors.$brand;
      }

      &:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
    }
  }
}

// ── animations ──
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes bounce {
  0%,
  60%,
  100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-6px);
  }
}
